<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transportes Ari - Envio de Documentos</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <header>
        <img src="logo.png" alt="Transportes Ari" class="logo">
        <!--h1>Transportes Ari</h1-->
        <p>Olá amigo motorista, como estão? Criamos esta aplicação para ficar mais prático e rápido para enviarem as despesas de viagem.</p>
    </header>
    <div class="container">
        <h2>Envio de Documentos de Viagem</h2>
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="form-group">
                <label for="tipo">Tipo de Documento:</label>
                <select id="tipo" name="tipo">
                    <option value="Carta Frete">Carta Frete</option>
                    <option value="Combustível">Despesa de Combustível</option>
                    <option value="Alimentação">Despesa de Alimentação</option>
                    <option value="Outras">Outras Despesas em Geral</option>
                </select>
            </div>
            <div class="form-group">
                <label for="placa">Placa do Caminhão:</label>
                <input 
                    type="text" 
                    id="placa" 
                    name="placa" 
                    placeholder="Ex: ABC1B34" 
                    maxlength="7" 
                    pattern="[A-Za-z0-9]{7}" 
                    required
                >
                <small>A placa deve ter exatamente 7 caracteres (letras e números).</small>
            </div>
            <div class="form-group">
                <label for="file">Arquivo:</label>
                <input type="file" id="file" name="file" required>
            </div>
            <button type="submit">Enviar Arquivo</button>
        </form>
        <!-- Loader -->
        <div class="loader" id="loader"></div>
        <div id="status"></div>
    </div>
    <footer>
        <p>&copy; 2025 Transportes Ari - Todos os direitos reservados</p>
    </footer>

    <script>
        const form = document.getElementById('uploadForm');
        const statusDiv = document.getElementById('status');
        const loader = document.getElementById('loader');
        const placaInput = document.getElementById('placa');

        // Função para converter o valor do campo placa para maiúsculas e validar
        placaInput.addEventListener('input', () => {
            let value = placaInput.value.toUpperCase(); // Converter para maiúsculas
            placaInput.value = value.replace(/[^A-Z0-9]/g, ''); // Remover caracteres inválidos
        });

        form.addEventListener('submit', e => {
            e.preventDefault();

            const file = form.file.files[0];
            const tipo = form.tipo.value;
            const placa = form.placa.value;

            if (!file || !tipo || !placa) {
                statusDiv.textContent = "Por favor, preencha todos os campos.";
                return;
            }

            if (placa.length !== 7) {
                statusDiv.textContent = "A placa deve ter exatamente 7 caracteres.";
                return;
            }

            // Exibir o loader
            loader.style.display = "block";
            statusDiv.textContent = ""; // Limpar mensagens anteriores

            const fr = new FileReader();
            fr.readAsArrayBuffer(file);
            fr.onload = f => {
                const url = "https://script.google.com/macros/s/AKfycbzYLPhuIzpr4YhsMU00WIo4OI5HmLLt2_zrwJquhYWuGJi5LvtgtbPfDYOvlEPo9Gm6/exec"; // Substitua pela URL do seu Web App

                const qs = new URLSearchParams({
                    filename: file.name,
                    mimeType: file.type,
                    tipo: tipo,
                    placa: placa
                });

                fetch(`${url}?${qs}`, {
                    method: "POST",
                    body: JSON.stringify([...new Int8Array(f.target.result)])
                })
                .then(res => res.json())
                .then(response => {
                    statusDiv.innerHTML = `Arquivo enviado com sucesso! <a href="${response.fileUrl}" target="_blank">Clique aqui para acessar</a>`;
                })
                .catch(err => {
                    statusDiv.textContent = "Erro ao enviar o arquivo.";
                    console.error(err);
                })
                .finally(() => {
                    // Ocultar o loader após a conclusão
                    loader.style.display = "none";
                });
            };
        });
    </script>
</body>
</html>
